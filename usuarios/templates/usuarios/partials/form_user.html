<form method="post" action="{{ request.path }}" class="needs-validation" novalidate>
    {% csrf_token %}

    <div class="row g-3">
        {% for field in form %}
        <div class="col-12 text-start">

            <label for="{{ field.id_for_label }}" class="form-label fw-bold">
                {{ field.label }}
            </label>

            {% if field.name == 'password' %}
                <input 
                    type="password" 
                    name="{{ field.name }}" 
                    class="form-control" 
                    id="{{ field.id_for_label }}"
                    {% if not form.instance.pk %}required{% endif %}
                >

            {% elif field.name == 'group' %}
                <select 
                    name="{{ field.name }}" 
                    class="form-select" 
                    id="{{ field.id_for_label }}" 
                    required
                >
                    <option value="">Seleccione un rol</option>

                    {% for choice in field.field.queryset %}
                        <option 
                            value="{{ choice.pk }}"
                            {% if field.value|stringformat:"s" == choice.pk|stringformat:"s" %}
                                selected
                            {% endif %}
                        >
                            {{ choice.name }}
                        </option>
                    {% endfor %}
                </select>

            {% else %}
                {{ field }}

            {% endif %}

            {% if field.errors %}
                <div class="text-danger small mt-1">
                    {{ field.errors.0 }}
                </div>
            {% endif %}

            {% if field.help_text %}
                <div class="form-text text-muted small">
                    {{ field.help_text }}
                </div>
            {% endif %}

        </div>
        {% endfor %}
    </div>

    <div class="modal-footer px-0 border-0 pb-0 mt-3">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i> Cancelar
        </button>

        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i> Guardar Usuario
        </button>
    </div>
</form>

<script>
    document.querySelectorAll('form input, form select, form textarea').forEach(function (element) {
        if (!element.classList.contains('form-control') && !element.classList.contains('form-select')) {
            if (element.tagName === 'SELECT') {
                element.classList.add('form-select');
            } else {
                element.classList.add('form-control');
            }
        }
    });
</script>
