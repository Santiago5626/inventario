name: Keep Render Services Alive

on:
  schedule:
    # Se ejecuta cada 5 minutos - Estrategia agresiva para contrarrestar retrasos de GitHub Actions
    # Colombia UTC-5
    - cron: '*/5 11-23 * * *'  # De 6 AM a 6:59 PM (Colombia)
    - cron: '*/5 0-4 * * *'    # De 7 PM a 11:59 PM (Colombia)
  workflow_dispatch: # Permite ejecutar manualmente
  push:              # Mantener trigger de debugging

jobs:
  ping-services:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar horario y hacer Ping
        run: |
          # Obtener hora actual en Colombia (UTC-5)
          CURRENT_HOUR=$(TZ=America/Bogota date +%H)
          echo "Hora actual en Colombia: $CURRENT_HOUR:xx"
          
          # Verificar si estamos en horario permitido (6 AM - 11:59 PM)
          # Nota: CURRENT_HOUR nunca es < 0, pero mantenemos la l√≥gica del usuario por consistencia si es su preferencia.
          # La condici√≥n principal es >= 6.
          if [ $CURRENT_HOUR -ge 6 ]; then
            echo "‚úÖ Horario permitido. Procediendo con ping..."
            
            # Usamos -L para seguir redirecciones
            response=$(curl -L -s -o /dev/null -w "%{http_code}" https://inventario-6hyb.onrender.com/)
            echo "Respuesta del servidor: $response"
            
            if [ $response -eq 200 ]; then
              echo "‚úÖ Aplicaci√≥n respondi√≥ correctamente"
            else
              echo "‚ö†Ô∏è Aplicaci√≥n respondi√≥ con c√≥digo: $response"
              exit 1
            fi
          else
            echo "üåô Fuera del horario permitido (00:00 - 05:59). No se hace ping."
          fi
